---
title: "Cross‑League Soccer Analysis"
output:
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bootswatch: journal    
    vertical_layout: fill
runtime: shiny
---
  
<style>
    .column { vertical-align: top !important; }
  body, .cell-content { text-align: left !important; }
</style>


```{r Setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r Libraries, echo = FALSE}
library(ggthemes)
library(plotly)
library(flexdashboard)
library(readr)
library(dplyr)
library(janitor)
library(polite)
library(purrr)
library(rvest)
library(stringr)
library(tidyverse)
```

```{r Data, echo = FALSE}
# Load CSV files
squads    <- read_csv("squads.csv")
standings <- read_csv("standings.csv")
```

ABOUT
=====================================

Column {data-width=600 .left-align}
-------------------------

#### Introduction

In this project, we explore soccer statistics from multiple professional football leagues using data from FBref (https://fbref.com/en/comps), a trusted site for advanced football analytics. While we initially focused on Major League Soccer (MLS), we extended our analysis to include other major international competitions such as the Premier League, La Liga, Bundesliga, and Serie A.

Our goal was to collect and organize standardized squad-level statistics across leagues to support comparative analysis. Specifically, we targeted the "Squad Standard Stats" tables on each competition’s main stats page. These tables contain information on team performance metrics such as matches played, goals, assists, average age, possession %, and more.

#### Method

We chose this dataset primarily out of personal interest: one of us enjoys following global football news, while the other is an avid FC25 player. Beyond our curiosity, we recognized that this data offers a rich opportunity for cross-league comparisons.

By scraping the same type of statistics from each league, we aimed to answer questions such as:

- Do older squads tend to score more goals, or is it the opposite? 
- Which leagues exhibit the highest goal efficiency? 
- Do teams with a higher discipline score tend to have fewer goals conceded? 
- Have teams overperformed or underperformed according to the expected stats?  
- Do possession-heavy teams always score more? 


These questions open the door for future data visualizations (like scatterplots or heatmaps) and statistical modeling (e.g., regression of goals on age or possession).

Column {data-width=600}
-------------------------

```{r league-image1, echo=FALSE}
renderImage({
  list(
    src    = "Top_2 .png",
    alt    = "Top 2 League Logos",
    width  = 600,
    height = 200
  )
})
```

```{r league-image2, echo=FALSE}
renderImage({
  list(
    src    = "Top_4.png",
    alt    = "Top 4 League Logos",
    width  = 600,
    height = 300
  )
})
```

<div style="text-align: center;">
```{r MLS-image, echo=FALSE}
renderImage({
  list(
    src    = "MLS.png",
    alt    = "MLS Logo",
    width  = 300,
    height = 300
  )
})
```
</div>

Standings 
==========================

```{r}
DT::renderDataTable({
	DT::datatable(standings, options = list(
			pageLength = 5,
			lengthMenu = list(c(5, 10, 20, 40, -1), c("5", "10", "20", "40", "All"))
	), rownames = FALSE)
})
```

---

Attacking Stats 
==========================

Column {data-width = 400}
-------------------------

### Average Age vs. Goals

```{r Avg Age vs Goals}
renderPlot({
	squads |> 
		ggplot(aes(x = age, y = gls, color = league)) +
			geom_point(aes(shape = league), size = 3) +
			geom_smooth(se = F, method = "lm", show.legend = F) +
			labs(x = "Average Age",
					 y = "Goals",
					 color = "League",
					 shape = "League") +
			scale_color_colorblind()
})
```

Column {data-width=400}
-------------------------

### Possession vs. Goals by League

```{r Possession vs Goals}
renderPlot({
  squads |>
    ggplot(aes(x = poss, y = gls, color = league)) +
    geom_point(size = 2, alpha = 0.8) +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      title = "Possession vs. Goals by League with Trend Lines",
      x = "Possession (%)",
      y = "Goals",
      color = "League"
    ) +
    scale_color_colorblind() +
    theme_minimal()
})
```

Column {data-width=400}
-------------------------

### Top 5 Teams by Goals per Game

```{r Top Teams Goals per Game}
renderPlot({
	squads |>
		group_by(league) |> 
		slice_max(goals_per_game, n = 5) |> 
		ggplot() +
			geom_col(aes(x = fct_reorder(squad, goals_per_game),
									 y = goals_per_game,
									 fill = league)) +
			labs(title = "Top 5 Teams by Goals per Game by League",
					 x = "Squad",
					 y = "Goals per Game",
					 fill = "League") +
			coord_flip() +
			scale_fill_colorblind()
})
```

Column {data-width=400}
-------------------------

### Discipline vs. Goals Conceded

```{r discipline-vs-ga}
renderPlot({
  squads |>
    ggplot(aes(x = discipline_score, y = g_a, color = league)) +
    geom_point(size = 2, alpha = 0.8) +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      title = "Discipline Score vs Goals Conceded",
      x = "Discipline Score",
      y = "Goals Conceded"
    ) +
    theme_bw()
})
```

---

Performance
==========================

{data-width = 600}
----------------------

### Expected & Actual Goals For & Against

```{r Performance Plot}
renderPlot({
	standings |> 
	mutate(Squad = fct_reorder(Squad, GF),
				 GFD = GF - xG,
				 GAD = xGA - GA,
				 GFP = ifelse(GFD < 0, 5,
				 			 ifelse(GFD == 0, 6, 1)),
				 GFP = as.factor(GFP),
				 GAP = ifelse(GAD < 0, 5,
				 			 ifelse(GAD == 0, 6, 1)),
				 GAP = as.factor(GAP)) |> 
		ggplot(aes(x = Squad)) +
			geom_point(aes(y = xG), color = "skyblue") +
			geom_segment(aes(y = xG, yend = GF, linetype = GFP),
									 lineend = "butt", linejoin = "round",
									 arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
									 size = 1, color = "skyblue",
									 show.legend = F) +
			geom_point(aes(y = xGA), color = "maroon") +
			geom_segment(aes(y = xGA, yend = GA, linetype = GAP),
									 lineend = "butt", linejoin = "round",
									 arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
									 size = 1, color = "maroon",
									 show.legend = F) +
			facet_wrap(~league, scales = "free") +
			coord_flip() +
			labs(x = "Squad",
					 y = "Goals") +
		  theme(axis.title = element_text(size = 15),
		  			axis.text = element_text(size = 12),
		  			strip.text = element_text(size = 12))
})
```

Conclusion 
==========================

Column {data-width = 200}
-------------------------

## Takeaways

- Older squads often correlate with higher scoring efficiency.  
- Possession percentage has a variable relationship with goals.  
- Top-performing teams consistently outscore their league averages.

## Next Steps

1. Build regression models per league.  
2. Incorporate expected goals (xG).  
3. Add time-series analysis across seasons.


